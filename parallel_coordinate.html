<!DOCTYPE html>
<html>

<head>
    <title>Parallel Coordinates Plot</title>
    <!-- Include D3.js -->
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        /* Add some basic styling */
        .axis line,
        .axis path {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 1.5px;
        }

        .line:hover {
            stroke: tomato;
            stroke-width: 3px;
        }
    </style>
</head>

<body>
    <script>
        // Set the dimensions and margins of the diagram
        var margin = { top: 30, right: 10, bottom: 10, left: 0 },
            width = 960 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

        // Append the svg object to the body of the page
        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");



        // Parse the Data
        d3.json("input.json").then(function (data) {
            // console.log(data)
            // Extract the list of dimensions and create a scale for each.
            const data_array = Object.values(data)
            console.log(data_array)

            dimensions = ["A", "B", "C"]

            var y = {
                "A": d3.scalePoint(["none", "skip_connect", "avg_pool_3x3", "nor_conv_1x1", "nor_conv_3x3"], [height, 0]),
                "B": d3.scalePoint(["none", "skip_connect", "avg_pool_3x3", "nor_conv_1x1", "nor_conv_3x3"], [height, 0]),
                "C": d3.scalePoint(["none", "skip_connect", "avg_pool_3x3", "nor_conv_1x1", "nor_conv_3x3"], [height, 0]),
            };

            // Build the X scale and axis:
            var x = d3.scalePoint()
                .range([0, width])
                .padding(1)
                .domain(dimensions);

            // The path function takes a row of the data as input, and returns the corresponding line.
            function path(d) {
                return d3.line()(dimensions.map(function (p) { return [x(p), y[p](d[p])]; }));
            }

            // Draw the lines
            svg.selectAll("myPath")
                .data(data_array)
                .enter().append("path")
                .attr("d", function (d) { return d3.line()(dimensions.map(function (p) { return [x(p), y[p](d[p])]; })); })

                .style("fill", "none")
                .style("stroke", "#000001")
                .style("opacity", 0.1);

            // Draw the axis:
            svg.selectAll("myAxis")
                .data(dimensions).enter()
                .append("g")
                .attr("transform", function (d) { return "translate(" + x(d) + ")"; })
                .each(function (d) { d3.select(this).call(d3.axisLeft().scale(y[d])); })
                .append("text")
                .style("text-anchor", "middle")
                .attr("y", -9)
                .text(function (d) { return d; })
                .style("fill", "black");

            // Add interaction
            svg.selectAll("path")
                .on("mouseover", function (event, d) {
                    console.log(event.target.style.stroke)
                    if (String(event.target.style.stroke).includes("rgb")) {
                        d3.select(this).transition().duration(200).style("opacity", 1);
                    }
                })
                .on("mouseout", function (event, d) {
                    if (String(event.target.style.stroke).includes("rgb")) {
                        d3.select(this).transition().duration(200).style("opacity", 0.1);
                    }
                });
        });


    </script>
</body>

</html>